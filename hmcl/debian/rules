#!/usr/bin/make -f

export JAVA_HOME=/usr/lib/jvm/default-java
export GRADLE_USER_HOME=/tmp/.gradle
export PKGDIR=debian/hmcl

%:
	dh $@

override_dh_auto_build:
	export HMCL_VERSION=$$(dpkg-parsechangelog -S Version | sed 's/-[^-]*$$//'); \
	export VERSION_TYPE=stable; \
	echo "Building HMCL version: $${HMCL_VERSION}, type: $${VERSION_TYPE}"; \
	./gradlew clean makeExecutables --stacktrace --no-daemon

override_dh_auto_install:
	rm -rf ${PKGDIR}

	mkdir -p ${PKGDIR}/usr/bin
	mkdir -p ${PKGDIR}/usr/share/applications
	mkdir -p ${PKGDIR}/usr/share/java/hmcl
	mkdir -p ${PKGDIR}/usr/share/icons/hicolor/32x32/apps
	mkdir -p ${PKGDIR}/usr/share/icons/hicolor/64x64/apps
	mkdir -p ${PKGDIR}/usr/share/icons/hicolor/128x128/apps
	mkdir -p ${PKGDIR}/usr/share/icons/hicolor/256x256/apps

	install -Dm755 debian/hmcl-launch-script ${PKGDIR}/usr/bin/hmcl
	install -Dm644 debian/hmcl.desktop ${PKGDIR}/usr/share/applications/hmcl.desktop
	install -Dm644 HMCL/build/libs/HMCL*.jar ${PKGDIR}/usr/share/java/hmcl/hmcl.jar
	install -Dm644 HMCL/build/resources/main/assets/img/icon.png ${PKGDIR}/usr/share/icons/hicolor/32x32/apps/hmcl.png
	install -Dm644 HMCL/build/resources/main/assets/img/icon@2x.png ${PKGDIR}/usr/share/icons/hicolor/64x64/apps/hmcl.png
	install -Dm644 HMCL/build/resources/main/assets/img/icon@4x.png ${PKGDIR}/usr/share/icons/hicolor/128x128/apps/hmcl.png
	install -Dm644 HMCL/build/resources/main/assets/img/icon@8x.png ${PKGDIR}/usr/share/icons/hicolor/256x256/apps/hmcl.png